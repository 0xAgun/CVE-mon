import requests
import json
import argparse 
from rich.console import Console
from rich.table import Table



def day_data():
    day_url = "https://cvetrends.com/api/cves/24hrs"
    req = requests.get(day_url).text
    parse_json = json.loads(req)
    cleaned_json = parse_json['data']
    table = Table(title="Daily CVE Monitor")
    table.add_column("CVE", style="bold cyan", justify="center")
    table.add_column("DESCRIPTION", style="#5882FA", justify="center")
    table.add_column("SEVERITY", style="bold #848484")

    for data in cleaned_json:
        cve = data['cve']
        descrip = data['description']
        if descrip is None:
            descrip = ""
        sevirity = data['severity']
        if sevirity is None:
            sevirity = ""

        table.add_row(f"{cve} \n", f"{descrip} \n", f"{sevirity} \n")

    console = Console()
    console.print(table)




def week_data():
    day_url = "https://cvetrends.com/api/cves/order-by-tweets-7days"
    req = requests.get(day_url).text
    parse_json = json.loads(req)
    cleaned_json = parse_json['data']
    table = Table(title="Weekly CVE Monitor")
    table.add_column("CVE", style="bold cyan", justify="center")
    table.add_column("DESCRIPTION", style="#5882FA", justify="center")
    table.add_column("SEVERITY", style="bold #848484")

    for data in cleaned_json:
        cve = data['cve']
        descrip = data['description']
        if descrip is None:
            descrip = ""
        sevirity = data['severity']
        if sevirity is None:
            sevirity = ""

        table.add_row(f"{cve} \n", f"{descrip} \n", f"{sevirity} \n")

    console = Console()
    console.print(table)


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Help Menu of CVE Monitor")
    parser.add_argument('-D', '--daily', action='store_true', help="Daily CVE Monitor")
    parser.add_argument('-W', '--weekly', action='store_true', help="Weekly CVE Monitor")
    args = parser.parse_args()

    if args.daily:
        day_data()
    elif args.weekly:
        week_data()
